<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="../assets/logo.svg">
<title>MathauraX Puzzle - Shape Matching</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
    margin: 0;
    padding: 1rem;
    color: #333;
    text-align: center;
  }
  h1 {
    color: #ff6f61;
    text-shadow: 1px 1px 2px #d94f3e;
    margin-bottom: 1rem;
    user-select: none;
  }
  p.instructions {
    font-size: 1.1rem;
    margin-bottom: 2rem;
    color: #5a2a27;
  }
  #puzzle-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 2rem;
    max-width: 700px;
    margin: 0 auto 3rem;
  }
  .shape-bank, .drop-zone {
    background: #fff;
    border-radius: 15px;
    padding: 1rem;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    min-width: 150px;
    min-height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .shape-bank {
    flex: 1;
  }
  .drop-zone {
    border: 3px dashed #ff6f61;
    flex: 1;
    position: relative;
  }
  .drop-zone.highlight {
    border-color: #4caf50;
    background-color: #e6f4ea;
  }
  .shape {
    width: 70px;
    height: 70px;
    margin: 10px;
    cursor: grab;
    user-select: none;
    transition: transform 0.3s ease;
  }
  .shape:active {
    cursor: grabbing;
  }
  /* Shapes */
  .circle {
    background: #f44336;
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(244, 67, 54, 0.6);
  }
  .square {
    background: #2196f3;
    box-shadow: 0 4px 6px rgba(33, 150, 243, 0.6);
  }
  .triangle {
    width: 0;
    height: 0;
    border-left: 35px solid transparent;
    border-right: 35px solid transparent;
    border-bottom: 70px solid #ffeb3b;
    box-shadow: 0 4px 6px rgba(255, 235, 59, 0.6);
    cursor: grab;
  }
  /* Pentagon shape */
  .pentagon {
    position: relative;
    width: 70px;
    height: 70px;
    background: #9c27b0;
    clip-path: polygon(
      50% 0%, 
      90% 35%, 
      75% 90%, 
      25% 90%, 
      10% 35%
    );
    box-shadow: 0 4px 6px rgba(156, 39, 176, 0.6);
  }

  /* Drop zone labels */
  .label {
    position: absolute;
    bottom: 8px;
    width: 100%;
    font-weight: bold;
    font-size: 1.1rem;
    color: #ff6f61;
    user-select: none;
  }

  /* Success message */
  #message {
    font-size: 1.4rem;
    color: #4caf50;
    font-weight: bold;
    margin-top: 1rem;
    display: none;
  }

  /* Button */
  button#reset-btn {
    background: #ff6f61;
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    color: #fff;
    font-weight: bold;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(255,111,97,0.6);
    transition: background-color 0.3s ease;
    user-select: none;
    margin-top: 1rem;
  }
  button#reset-btn:hover {
    background: #ff3b20;
  }
</style>
</head>
<body>

<h1>Shape Matching Puzzle</h1>
<p class="instructions">Drag each shape from the left and drop it on the matching shape name on the right. Have fun!</p>

<div id="puzzle-container">
  <div class="shape-bank" aria-label="Shapes to drag" id="shape-bank">
    <!-- Shapes will be generated by JS -->
  </div>

  <div id="drop-zones-container" style="display:flex; flex:1; gap: 1rem; flex-wrap: wrap; justify-content: center;">
    <!-- Drop zones generated by JS -->
  </div>
</div>

<div>
  <button id="reset-btn" aria-label="Reset Puzzle">Click here for a new puzzle</button>
</div>

<div id="message" role="alert" aria-live="polite"></div>

<script>
  const puzzleSets = [
    {
      shapes: ['circle', 'square', 'triangle', 'pentagon'],
      labels: ['Circle', 'Square', 'Triangle', 'Pentagon'],
      colors: ['#f44336', '#2196f3', '#ffeb3b', '#9c27b0']
    },
    {
      shapes: ['square', 'triangle', 'circle'],
      labels: ['Square', 'Triangle', 'Circle'],
      colors: ['#2196f3', '#ffeb3b', '#f44336']
    },
    {
      shapes: ['triangle', 'pentagon', 'circle'],
      labels: ['Triangle', 'Pentagon', 'Circle'],
      colors: ['#ffeb3b', '#9c27b0', '#f44336']
    },
    {
      shapes: ['pentagon', 'circle', 'square'],
      labels: ['Pentagon', 'Circle', 'Square'],
      colors: ['#9c27b0', '#f44336', '#2196f3']
    }
  ];

  const shapeBank = document.getElementById('shape-bank');
  const dropZonesContainer = document.getElementById('drop-zones-container');
  const message = document.getElementById('message');
  const resetBtn = document.getElementById('reset-btn');

  let currentPuzzle = null;

  function createShapeElement(type, color) {
    const div = document.createElement('div');
    div.classList.add('shape');
    div.setAttribute('draggable', 'true');
    div.setAttribute('aria-grabbed', 'false');
    div.setAttribute('tabindex', '0');
    div.setAttribute('role', 'button');
    div.setAttribute('aria-label', `${type.charAt(0).toUpperCase() + type.slice(1)}`);

    // Apply color and shape style
    if(type === 'circle') {
      div.classList.add('circle');
      div.style.backgroundColor = color;
      div.style.boxShadow = `0 4px 6px ${color}99`;
    } else if(type === 'square') {
      div.classList.add('square');
      div.style.backgroundColor = color;
      div.style.boxShadow = `0 4px 6px ${color}99`;
    } else if(type === 'triangle') {
      div.classList.add('triangle');
      // triangle uses border color, override below:
      div.style.borderBottomColor = color;
      div.style.boxShadow = `0 4px 6px ${color}99`;
    } else if(type === 'pentagon') {
      div.classList.add('pentagon');
      div.style.backgroundColor = color;
      div.style.boxShadow = `0 4px 6px ${color}99`;
    }

    return div;
  }

  function createDropZone(type, label, color) {
    const dz = document.createElement('div');
    dz.classList.add('drop-zone');
    dz.setAttribute('data-shape', type);
    dz.setAttribute('tabindex', '0');
    dz.setAttribute('aria-dropeffect', 'none');

    const lbl = document.createElement('div');
    lbl.classList.add('label');
    lbl.textContent = label;
    lbl.style.color = color;

    dz.appendChild(lbl);
    return dz;
  }

  function setupPuzzle() {
    shapeBank.innerHTML = '';
    dropZonesContainer.innerHTML = '';
    message.style.display = 'none';
    message.textContent = '';

    // Pick a random puzzle set
    currentPuzzle = puzzleSets[Math.floor(Math.random() * puzzleSets.length)];

    // Create shapes and drop zones
    currentPuzzle.shapes.forEach((shape, i) => {
      const shapeEl = createShapeElement(shape, currentPuzzle.colors[i]);
      shapeEl.id = `shape-${shape}-${i}`;
      shapeBank.appendChild(shapeEl);
    });

    currentPuzzle.shapes.forEach((shape, i) => {
      const dz = createDropZone(shape, currentPuzzle.labels[i], currentPuzzle.colors[i]);
      dz.id = `drop-${shape}-${i}`;
      dropZonesContainer.appendChild(dz);
    });

    addDragAndDropListeners();
  }

  let draggedShape = null;

  function addDragAndDropListeners() {
    const shapes = shapeBank.querySelectorAll('.shape, .pentagon, .triangle, .circle, .square');
    const dropZones = dropZonesContainer.querySelectorAll('.drop-zone');

    shapes.forEach(shape => {
      shape.addEventListener('dragstart', dragStart);
      shape.addEventListener('dragend', dragEnd);
    });

    dropZones.forEach(zone => {
      zone.addEventListener('dragover', dragOver);
      zone.addEventListener('dragenter', dragEnter);
      zone.addEventListener('dragleave', dragLeave);
      zone.addEventListener('drop', drop);
    });
  }

  function dragStart(e) {
    draggedShape = e.target;
    e.dataTransfer.setData('text/plain', e.target.id);
    e.target.style.opacity = '0.6';
    e.target.setAttribute('aria-grabbed', 'true');
  }
  function dragEnd(e) {
    e.target.style.opacity = '1';
    e.target.setAttribute('aria-grabbed', 'false');
  }
  function dragOver(e) {
    e.preventDefault();
  }
  function dragEnter(e) {
    e.preventDefault();
    e.target.classList.add('highlight');
  }
  function dragLeave(e) {
    e.target.classList.remove('highlight');
  }
  function drop(e) {
    e.preventDefault();
    e.target.classList.remove('highlight');
    const shapeId = e.dataTransfer.getData('text/plain');
    const draggedElement = document.getElementById(shapeId);
    if (!draggedElement) return;

    const dropShape = e.target.getAttribute('data-shape');

    // Get shape type from dragged element id
    // Format: shape-<type>-<index>
    const draggedShapeType = draggedElement.id.split('-')[1];

    if (dropShape === draggedShapeType) {
      e.target.appendChild(draggedElement);
      draggedElement.setAttribute('draggable', 'false');
      draggedElement.style.cursor = 'default';
      draggedElement.style.margin = '0 auto';
      draggedElement.style.position = 'relative';
      draggedElement.style.top = 'auto';
      draggedElement.style.left = 'auto';

      checkPuzzleComplete();
    } else {
      alert('Oops! That shape does not match. Try again.');
    }
  }

  function checkPuzzleComplete() {
    const dropZones = dropZonesContainer.querySelectorAll('.drop-zone');
    for (const zone of dropZones) {
      if (!zone.querySelector('.shape')) {
        return; // not complete yet
      }
    }
    message.textContent = 'ðŸŽ‰ Congratulations! You matched all shapes correctly! ðŸŽ‰';
    message.style.display = 'block';
  }

  resetBtn.addEventListener('click', () => {
    setupPuzzle();
  });

  // Initialize puzzle on page load
  setupPuzzle();

</script>
<script type="module" src="scripts/auth.js"></script>

</body>
</html>
